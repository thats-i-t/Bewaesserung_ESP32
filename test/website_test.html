
<!DOCTYPE html>
<html>
	
<head>
	<title>Steuerung Gew√§chshaus</title>
	
	
</head>
<body>
	<center>
		<h1>Steuerung<br>Gewaechshaus</h1>

		<p></p>
		<label class="container">
			<b>Automatisierung</b>
			<input type="checkbox" id="mode" onclick="set_value(this.id)" /><br><br>
			<span class="checkmark"></span>
		</label><br><br>

		<label class="container">
			<b>Pumpe 1</b>
			<input type="checkbox" id="pump1" onclick="set_value(this.id)" /><br><br>
			<span class="checkmark"></span>
		</label><br><br>

		<label class="container">
			<b>Pumpe 2</b>
			<input type="checkbox" id="pump2"  onclick="set_value(this.id)" /><br><br>
			<span class="checkmark"></span>
		</label><br><br>

		<label class="container">
			<b>Pumpe 3</b>
			<input type="checkbox" id="pump3"  onclick="set_value(this.id)" /><br><br>
			<span class="checkmark"></span>
		</label><br><br>

		<label class="container">
			<b>Ventilator</b>
			<input type="checkbox" id="vent"  onclick="set_value(this.id)" /><br><br>
			<span class="checkmark"></span>
		</label><br><br>

		<label class="container">
			<b>Licht</b>
			<input type="checkbox" id="light"  onclick="set_value(this.id)" /><br><br>
			<span class="checkmark"></span>
		</label><br><br>


		<p></p>
		<p></p>
		<p></p>
		<h2>Sensordaten</h2>
		Periodic refresh?<input type="checkbox" id="auto_refresh" checked=true/><br><br>
		<input type="button" id="Eingabe" value= 'Refresh manually' onclick="read_all_sensors();displayCurrentTime()"/><br>
    	<p id="timeDisplay"></p>

		<p></p>
		<b>Feuchtigkeitssensor 1</b><br><span id="moist1"></span><br>

		<b>Feuchtigkeitssensor 2</b><br><span id="moist2"></span><br>

		<b>Feuchtigkeitssensor 3</b><br><span id="moist3"></span><br>

		<b>Lufttemperatur</b><br><span id="airtemp"></span><br>

		<b>Luftfeuchte</b><br><span id="airhumid"></span><br>
    </center>
</body>
<style>
	h1 {
		color: green;
	}
		
	/* Customize the label (the container) */
	.container {
	position: absolute;
	left: 38%;
	padding-left: 35px;
	margin-bottom: 12px;
	margin-left: auto;
	margin-right: auto;
	cursor: pointer;
	font-size: 17px;
	-webkit-user-select: none;
	-moz-user-select: none;
	-ms-user-select: none;
	user-select: none;
	}

	/* Hide the browser's default radio button */
	.container input {
	position: absolute;
	opacity: 0;
	cursor: pointer;
	height: 0;
	width: 0;
	}

	/* Create a custom radio button */
	.checkmark {
	position: absolute;
	top: -4px;
	left: -2px;
	height: 25px;
	width: 25px;
	background-color: #ed0b0b;
	border-radius: 50%;
	}

	/* On mouse-over, add a grey background color */
	.container:hover input ~ .checkmark {
	background-color: #f0d7cf;
	}


	/* When the radio button is checked, add a blue background */
	.container input:checked ~ .checkmark {
	background-color: #09ec59;
	}

	/* Create the indicator (the dot/circle - hidden when not checked) */
	.checkmark:after {
	content: "";
	position: absolute;
	display: none;
	}

	/* Show the indicator (dot/circle) when checked */
	.container input:checked ~ .checkmark:after {
	display: block;
	}

	/* Style the indicator (dot/circle) */
	.container .checkmark:after {
	top: 9px;
	left: 9px;
	width: 8px;
	height: 8px;
	border-radius: 50%;
	background: white;
	}
</style>

<script>
	const ipStr = 'http://192.168.178.67/';
	let lastTime = null;

	function refresh_data()
	{
		read_all_sensors();
		read_all_actuator_states();
		displayCurrentTime();
	}
	refresh_data();

	var intervalId = setInterval(function() {
		if(document.getElementById("auto_refresh").checked == true)
		{
			refresh_data();
		}
	  }, 3000);

	async function setParam(api, name, val)
	{
		var req = ipStr + api + '?' + name + '=' + val;
		console.log("url: " + req);
		console.log("Sending: " + name + "=" + val);
		const response = await fetch(req, { method: 'post', mode: 'cors' });
		var valRcv = await response.text();
		console.log("Received: " + name + "=" + valRcv);
		return valRcv;
	}

    function set_value(id)
    {
		var cb = document.getElementById(id);
		setParam("set-value", id, +cb.checked).then((valueStr) => { cb.checked = valueStr > 0; });
    }

	async function read_value(id)
	{
		var dummy = 0;
		const val = await setParam('get-value', id, dummy);
		return val;
	}

    function read_all_sensors()
    {
		read_value("moist1").then((valueStr) => { document.getElementById("moist1").innerHTML = valueStr; });
		read_value("moist2").then((valueStr) => { document.getElementById("moist2").innerHTML = valueStr; });
		read_value("moist3").then((valueStr) => { document.getElementById("moist3").innerHTML = valueStr; });
		read_value("airtemp").then((valueStr) => { document.getElementById("airtemp").innerHTML = valueStr; });
		read_value("airhumid").then((valueStr) => { document.getElementById("airhumid").innerHTML = valueStr; });
    }

    function read_all_actuator_states()
    {
		read_value("mode").then((valueStr) => { document.getElementById("mode").checked = valueStr > 0; });
		read_value("pump1").then((valueStr) => { document.getElementById("pump1").checked = valueStr > 0; });
		read_value("pump2").then((valueStr) => { document.getElementById("pump2").checked = valueStr > 0; });
		read_value("pump3").then((valueStr) => { document.getElementById("pump3").checked = valueStr > 0; });
		read_value("vent").then((valueStr) => { document.getElementById("vent").checked = valueStr > 0; });
		read_value("light").then((valueStr) => { document.getElementById("light").checked = valueStr > 0; });
    }

	function displayCurrentTime() {
		const currentTime = new Date().toLocaleTimeString();
		const timeDisplay = document.getElementById("timeDisplay");

		if (lastTime === null) {
			timeDisplay.textContent = `Update: ${currentTime}`;
			lastTime = currentTime;
		} else {
			timeDisplay.textContent = `Update: ${currentTime}`;
			lastTime = currentTime;
		}
	}

</script>

</html>
