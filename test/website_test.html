
<!DOCTYPE html>
<html>
<head>
	<title>Steuerung Gewächshaus</title>
</head>
<body>
	<center>
		<h1>Steuerung Gewächshaus</h1>
		<b>Pumpe 1</b><input type="checkbox" id="pump1"  onclick="set_value(this.id)" /><br><br>
		<b>Pumpe 2</b><input type="checkbox" id="pump2"  onclick="set_value(this.id)" /><br><br>
		<b>Sensoren auslesen</b><input type="button" id="read_sensors" onclick="read_all_sensors()"/><br><br>
		<b>Feuchtigkeitssensor 1</b><br><span id="moist1"></span><br><br>
    </center>
</body>
<script>
	const ipStr = 'http://192.168.178.67/';

	async function setParam(api, name, val)
	{
		var req = ipStr + api + '?' + name + '=' + val;
		console.log("url: " + req);
		console.log("Sending: " + name + "=" + val);
		const response = await fetch(req, { method: 'post', mode: 'cors' })
		var valRcv = await response.text();
		console.log("Received: " + name + "=" + valRcv);
		return valRcv;
	}

    function set_value(id)
    {
		var cb = document.getElementById(id);
		setParam("test_post", id, +cb.checked).then((valueStr) => { cb.checked = valueStr > 0; });
    }

	async function read_value(id)
	{
		var dummy = 0;
		const val = await setParam('get_sensor', id, dummy);
		return val;
	}

    function read_all_sensors()
    {
		read_value("moist1").then((valueStr) => { document.getElementById("moist1").innerHTML = valueStr; });
    }
</script>

</html>
